# Quake Log Summarizer - Bash

This repository contains a simple bash script that parses a [Quake III Arena](https://github.com/id-Software/Quake-III-Arena) server log to summarize matches statistics.

This script is intended to show how bash scripts and regular expressions may be a quick and efficient way to solve some problems.
I don't encourage users to use this as a parser for production environments due to several technical debits:
- Maintenance to add features or fix bugs may be painful. 
- This script does a lot of I/O reading the log file more than once to get a match statistics.

Even so this script may be an useful tool to quickly parse small log files or to help implementing another parser.

## Match Summary

The script reads a server log and prints a [JSON](https://www.json.org/) object that summarizes each match (not an JSON array contaning all matches summaries). This is a sample:

```json
{
  "game_2": {
    "players": [
      "Isgalamido"
    ],
    "total_kills": "0",
    "kills": {
      "Isgalamido": "0"
    }
  }
}
{
  "game_3": {
    "players": [
      "Isgalamido",
      "Dono da Bola"
    ],
    "total_kills": "11",
    "kills": {
      "Isgalamido": "-7",
      "Dono da Bola": "0"
    }
  }
}
```

| Field         | Description                                                                               |
|---------------|-------------------------------------------------------------------------------------------|
| `game_{index}`| A match name (generated by the script). Uses an one-based index                           |
| `players`     | All players' name that joined the match                                                   |
| `total_kills` | Total kills in the match (includes world's kills and suicides)                            |
| `kills`       | The match final score. The keys are the players' names and the values are the final score |

### Notes

1. A player may change his name during a match. This parser will show the output based on the first player's name inside a match.
2. Suicides are included on match total kills.
3. Suicides are ignored on player's score (neither increases nor decreases his kills).
4. Some matches may contain truncated log data (maybe due to a crash on the server). This script will still summarize these matches.

## Usage

### Dependencies

This script depends on:
- Basic commands included on most Linux installations (e.g.: `grep`, `sed`, `sort`, `wc`, `uniq`).
- [jq](https://stedolan.github.io/jq/) - a command line JSON processor.

### Running

```bash
$ ./parse.sh LOG_FILE
```
The script parses `LOG_FILE` and prints all matches summaries in JSON format (one JSON per match).


## TODO List

The following may be future enhancements:

- Improve script JSON response to include all player's name inside a match.
- Warn when a match log is truncated.
- Avoid read a match log more than once to improve script performance.
- Change match summary object to improve integrations (read the current object may be painful).
- Extract more useful information from log messages.
- Clean up temporary files after script execution.

## Contributing

TODO.
(Feel free to open issues and submit pull requests)
